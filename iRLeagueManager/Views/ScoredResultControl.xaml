<UserControl x:Class="iRLeagueManager.Views.ScoredResultControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vmodel="clr-namespace:iRLeagueManager.ViewModels"
             xmlns:local="clr-namespace:iRLeagueManager.Views"
             xmlns:conv="clr-namespace:iRLeagueManager.Converters"
             mc:Ignorable="d"  
             d:DesignHeight="600" d:DesignWidth="800" Background="White" FontSize="14">
    <!--<UserControl.DataContext>
        <vmodel:ResultsPageViewModel/>
    </UserControl.DataContext>-->
    <UserControl.Resources>
        <conv:LapIntervalStringConverter x:Key="LapIntervalStringConverter"/>
        <Path x:Key="PencilPlusOutline" x:Shared="False"
              Data="M14.1,9L15,9.9L5.9,19H5V18.1L14.1,9M17.7,3C17.5,3 17.2,3.1 17,3.3L15.2,5.1L18.9,8.9L20.7,7C21.1,6.6 21.1,6 20.7,5.6L18.4,3.3C18.2,3.1 17.9,3 17.7,3M14.1,6.2L3,17.2V21H6.8L17.8,9.9L14.1,6.2M7,2V5H10V7H7V10H5V7H2V5H5V2H7Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type ContentControl}}, Path=Foreground}"/>
        <Path x:Key="PlusThick" x:Shared="False"
              Data="M20 14H14V20H10V14H4V10H10V4H14V10H20V14Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type ContentControl}}, Path=Foreground}"/>
        <Path x:Key="delete" x:Shared="False"
              Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type ContentControl}}, Path=Foreground}"/>
            <Path x:Key="closeThick" x:Shared="False"
              Data="M20 6.91L17.09 4L12 9.09L6.91 4L4 6.91L9.09 12L4 17.09L6.91 20L12 14.91L17.09 20L20 17.09L14.91 12L20 6.91Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type ContentControl}}, Path=Foreground}"/>
        <Path x:Key="closeOutlineRed" x:Shared="False"
              Data="M3,16.74L7.76,12L3,7.26L7.26,3L12,7.76L16.74,3L21,7.26L16.24,12L21,16.74L16.74,21L12,16.24L7.26,21L3,16.74M12,13.41L16.74,18.16L18.16,16.74L13.41,12L18.16,7.26L16.74,5.84L12,10.59L7.26,5.84L5.84,7.26L10.59,12L5.84,16.74L7.26,18.16L12,13.41Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type ContentControl}}, Path=Foreground}"/>
        <Path x:Key="checkOutlineGreen" x:Shared="False"
          Data="M19.78,2.2L24,6.42L8.44,22L0,13.55L4.22,9.33L8.44,13.55L19.78,2.2M19.78,5L8.44,16.36L4.22,12.19L2.81,13.55L8.44,19.17L21.19,6.42L19.78,5Z"
              Fill="Green"/>
        <Path x:Key="checkBold" x:Shared="False"
              Data="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z" 
              Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type ContentControl}}, Path=Foreground}"/>
        <Path x:Key="pencilOutline" x:Shared="False"
              Data="M14.06,9L15,9.94L5.92,19H5V18.08L14.06,9M17.66,3C17.41,3 17.15,3.1 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18.17,3.09 17.92,3 17.66,3M14.06,6.19L3,17.25V21H6.75L17.81,9.94L14.06,6.19Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type ContentControl}}, Path=Foreground}"/>
        <Path x:Key="TableArrowUp" x:Shared="False"
              Data="M4 3H18C19.11 3 20 3.9 20 5V12.08C18.45 11.82 16.92 12.18 15.68 13H12V17H13.08C12.97 17.68 12.97 18.35 13.08 19H4C2.9 19 2 18.11 2 17V5C2 3.9 2.9 3 4 3M4 7V11H10V7H4M12 7V11H18V7H12M4 13V17H10V13H4M21.94 17.5H19.94V21.5H17.94V17.5H15.94L18.94 14.5L21.94 17.5"
              Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type ContentControl}}, Path=Foreground}"/>
        <Path x:Key="CogRefresh" x:Shared="False"
              Data="M18 14.5C19.1 14.5 20.1 14.9 20.8 15.7L22 14.5V18.5H18L19.8 16.7C19.3 16.3 18.7 16 18 16C16.6 16 15.5 17.1 15.5 18.5S16.6 21 18 21C18.8 21 19.5 20.6 20 20H21.7C21.1 21.5 19.7 22.5 18 22.5C15.8 22.5 14 20.7 14 18.5S15.8 14.5 18 14.5M11.5 18.5C11.5 17.4 11.8 16.4 12.2 15.5H12C10.1 15.5 8.5 13.9 8.5 12S10.1 8.5 12 8.5 15.5 10.1 15.5 12C15.5 12.2 15.5 12.4 15.4 12.5C16.2 12.2 17 12 18 12C18.5 12 19 12.1 19.5 12.2V12C19.5 11.7 19.5 11.3 19.4 11L21.5 9.4C21.7 9.2 21.7 9 21.6 8.8L19.6 5.3C19.5 5 19.3 5 19 5L16.5 6C16 5.6 15.4 5.3 14.8 5L14.4 2.3C14.5 2.2 14.2 2 14 2H10C9.8 2 9.5 2.2 9.5 2.4L9.1 5.1C8.5 5.3 8 5.7 7.4 6L5 5C4.7 5 4.5 5 4.3 5.3L2.3 8.8C2.2 9 2.3 9.2 2.5 9.4L4.6 11C4.6 11.3 4.5 11.7 4.5 12S4.5 12.7 4.6 13L2.5 14.7C2.3 14.9 2.3 15.1 2.4 15.3L4.4 18.8C4.5 19 4.7 19 5 19L7.5 18C8 18.4 8.6 18.7 9.2 19L9.6 21.7C9.6 21.9 9.8 22.1 10.1 22.1H12.6C11.9 21 11.5 19.8 11.5 18.5Z"
              Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type ContentControl}}, Path=Foreground}"/>
        <Path x:Key="Cached" x:Shared="False"
              Data="M19,8L15,12H18A6,6 0 0,1 12,18C11,18 10.03,17.75 9.2,17.3L7.74,18.76C8.97,19.54 10.43,20 12,20A8,8 0 0,0 20,12H23M6,12A6,6 0 0,1 12,6C13,6 13.97,6.25 14.8,6.7L16.26,5.24C15.03,4.46 13.57,4 12,4A8,8 0 0,0 4,12H1L5,16L9,12"
              Fill="{Binding RelativeSource={RelativeSource AncestorType={x:Type ContentControl}}, Path=Foreground}"/>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="Session Results" FontSize="20" FontWeight="Bold"/>
        <ComboBox Grid.Row="1" ItemsSource="{Binding ScheduleList}" SelectedItem="{Binding SelectedSchedule}" DisplayMemberPath="Name"/>
        <DockPanel Grid.Row="2" HorizontalAlignment="Stretch">
            <Button Content="&lt;" Padding="5" DockPanel.Dock="Left" Command="{Binding PreviousSessionCmd}"/>
            <Button Content="&gt;" Padding="5" DockPanel.Dock="Right" Command="{Binding NextSessionCmd}"/>
            <!--<TextBlock Margin="2">
                <TextBlock.Text>
                    <MultiBinding StringFormat="{}{0} - {1}">
                        <Binding Path="Session.Date" StringFormat="Date"/>
                        <Binding Path="Session.Location.FullName"/>
                    </MultiBinding>
                </TextBlock.Text>
            </TextBlock>-->
            <ComboBox ItemsSource="{Binding SessionList}" SelectedItem="{Binding SelectedSession}">
                <ComboBox.ItemTemplate>
                    <DataTemplate DataType="{x:Type ComboBoxItem}">
                        <TextBlock>
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0} - {1} ({2})">
                                    <Binding Path="Date" StringFormat="Date"/>
                                    <Binding Path="Location.FullName"/>
                                    <Binding Path="Schedule.Name"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
                <ComboBox.ItemContainerStyle>
                    <Style TargetType="ComboBoxItem">
                        <Setter
                    Property="IsEnabled"
                    Value="{Binding ResultAvailable}" />
                    </Style>
                </ComboBox.ItemContainerStyle>
            </ComboBox>
        </DockPanel>
        <DataGrid Grid.Row="3" ItemsSource="{Binding SelectedResult.FinalResults}" AutoGenerateColumns="False" Height="Auto" AlternationCount="2" AlternatingRowBackground="#F0F0F0">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Pos." Binding="{Binding FinalPosition}" IsReadOnly="True"/>
                <DataGridTextColumn Header="Chg." Binding="{Binding PositionChange, StringFormat={}{0:+#;-#;' - '}}" IsReadOnly="True"/>
                <DataGridTextColumn Header="Start" Binding="{Binding StartPosition}" IsReadOnly="True"/>
                <DataGridTextColumn Header="Name" Binding="{Binding Member.FullName}" IsReadOnly="True"/>
                <DataGridTextColumn Header="Team" IsReadOnly="True"/>
                <DataGridTextColumn Header="Fast Lap" IsReadOnly="True">
                    <DataGridTextColumn.Binding>
                        <MultiBinding StringFormat="{}{0:00}:{1:00},{2:000}">
                            <Binding Path="FastestLapTime.Minutes"/>
                            <Binding Path="FastestLapTime.Seconds"/>
                            <Binding Path="FastestLapTime.Milliseconds"/>
                        </MultiBinding>
                    </DataGridTextColumn.Binding>
                </DataGridTextColumn>
				<DataGridTextColumn Header="Avg. Lap" IsReadOnly="True">
					<DataGridTextColumn.Binding>
						<MultiBinding StringFormat="{}{0:00}:{1:00},{2:000}">
							<Binding Path="AvgLapTime.Minutes"/>
							<Binding Path="AvgLapTime.Seconds"/>
							<Binding Path="AvgLapTime.Milliseconds"/>
						</MultiBinding>
					</DataGridTextColumn.Binding>
				</DataGridTextColumn>
				<DataGridTextColumn Header="Interval" Binding="{Binding Interval, Converter={StaticResource LapIntervalStringConverter}}"/>
                <DataGridTextColumn Header="Race Pts." Binding="{Binding RacePoints}" IsReadOnly="True"/>
                <DataGridTextColumn Header="Bonus Pts." Binding="{Binding BonusPoints}" IsReadOnly="True"/>
                <DataGridTextColumn Header="Penalty" Binding="{Binding PenaltyPoints, StringFormat={}{0:-#;0;0}}" IsReadOnly="True"/>
                <DataGridTextColumn Header="Total Pts." Binding="{Binding TotalPoints}" IsReadOnly="True"/>
                <DataGridTemplateColumn Header="Add Penalty">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBox Text="{Binding AddPenalty.PenaltyPoints, UpdateSourceTrigger=PropertyChanged}" Width="25">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox">
                                            <Setter Property="IsReadOnly" Value="True"/>
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsPenaltyEdit}" Value="True">
                                                    <Setter Property="IsReadOnly" Value="False"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding AddPenalty}" Value="{x:Null}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>
                                <Button BorderBrush="Transparent" Background="Transparent">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Command" Value="{Binding EndEditPenaltyCmd}"/>
                                            <Setter Property="Foreground" Value="Green"/>
                                            <Setter Property="Content" Value="{StaticResource checkBold}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsPenaltyEdit}" Value="False">
                                                    <Setter Property="Command" Value="{Binding StartEditPenaltyCmd}"/>
                                                    <Setter Property="Foreground" Value="Black" />
                                                    <Setter Property="Content" Value="{StaticResource pencilOutline}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding AddPenalty}" Value="{x:Null}">
                                                    <Setter Property="Command" Value="{Binding AddPenaltyCmd}"/>
                                                    <Setter Property="Foreground" Value="Black"/>
                                                    <Setter Property="Content" Value="{StaticResource PencilPlusOutline}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                <Button BorderBrush="Transparent" Background="Transparent" Command="{Binding DeletePenaltyCmd}" Content="{StaticResource closeThick}" Foreground="Red">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding AddPenalty}" Value="{x:Null}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="{StaticResource delete}" Foreground="Black" Background="Transparent" BorderBrush="Transparent" Click="DeleteRowButton_Click" Tag="{Binding}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
        <TextBox Grid.Row="3" Margin="10" Text="{Binding StatusMsg}" VerticalAlignment="Top">
            <TextBox.Style>
                <Style TargetType="TextBox">
                    <Setter Property="Visibility" Value="Visible"/>
                    <Style.Triggers>
                        <Trigger Property="Text" Value="">
                            <Setter Property="Visibility" Value="Collapsed"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </TextBox.Style>
        </TextBox>

        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Command="{Binding RefreshCmd}" Padding="1" BorderBrush="Transparent" Background="Transparent" Margin="5,0">
                <Button.Content>
                    <StackPanel Orientation="Horizontal" FlowDirection="LeftToRight">
                        <ContentControl Margin="0,0,5,0">
                            <StaticResource ResourceKey="Cached"/>
                        </ContentControl>
                        <TextBlock Text="Refresh"  FontSize="18"/>
                    </StackPanel>
                </Button.Content>
            </Button>
            <Button Command="{Binding CalculateResultsCmd}" BorderBrush="Transparent" Background="Transparent" Margin="5,0">
                <Button.Content>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <ContentControl Foreground="Black" Margin="0,0,5,0">
                            <StaticResource ResourceKey="CogRefresh"/>
                        </ContentControl>
                        <TextBlock Text="Calculate"  FontSize="18"/>
                    </StackPanel>
                </Button.Content>
            </Button>
        </StackPanel>
    </Grid>
</UserControl>
